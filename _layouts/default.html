            // form submission handled
<!DOCTYPE html>
<html>
    {% include head.html %}
    <body id="page-top" class="index">
                <!-- Include the language switcher -->
                {% include language-switcher.html %}

                <!-- Expose translations to JavaScript -->
                <script>
                    (function(){
                        try {
                            window.I18N = {
                                en: {{ site.data.en | jsonify }},
                                'pt-br': {{ site.data['pt-br'] | jsonify }}
                            };
                        } catch (e) {
                            console.error('I18N initialization failed', e);
                            window.I18N = { en: {}, 'pt-br': {} };
                        }
                    })();
                </script>

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only" data-en="{{ site.data.en.aria.toggle_navigation }}" data-pt-br="{{ site.data['pt-br'].aria.toggle_navigation }}">{{ site.data.en.aria.toggle_navigation }}</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#page-top">{{ site.header.title | default: site.title }}</a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="hidden">
                            <a href="#page-top"></a>
                        </li>
                        <li class="page-scroll">
                            <a href="#portfolio" data-en="{{ site.data.en.nav.portfolio }}" data-pt-br="{{ site.data['pt-br'].nav.portfolio }}">{{ site.data.en.nav.portfolio }}</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#about" data-en="{{ site.data.en.nav.about }}" data-pt-br="{{ site.data['pt-br'].nav.about }}">{{ site.data.en.nav.about }}</a>
                        </li>
                        <li class="page-scroll">
                            <a href="#contact" data-en="{{ site.data.en.nav.contact }}" data-pt-br="{{ site.data['pt-br'].nav.contact }}">{{ site.data.en.nav.contact }}</a>
                        </li>
                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>        <!-- Header -->
        <header>
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        {% if site.header.avatar %}
                        <img class="img-responsive" src="{{ site.header.avatar | prepend: site.baseurl }}" alt="{{ site.header.title | default: site.title }}" data-en-alt="Profile Picture" data-pt-br-alt="Foto de Perfil">
                        {% endif %}
                        <div class="intro-text">
                            <span class="name" data-en="{{ site.data.en.header.title | default: site.header.title | default: site.title }}" data-pt-br="{{ site.data['pt-br'].header.title | default: site.header.title | default: site.title }}">{{ site.data.en.header.title | default: site.header.title | default: site.title }}</span>
                            <hr class="star-light">
                            <span class="skills" data-en="{{ site.data.en.header.subtitle | default: site.header.subtitle }}" data-pt-br="{{ site.data['pt-br'].header.subtitle | default: site.header.subtitle }}">{{ site.data.en.header.subtitle | default: site.header.subtitle }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Portfolio Grid Section -->
        <section id="portfolio">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2 data-en="{{ site.data.en.portfolio.title }}" data-pt-br="{{ site.data['pt-br'].portfolio.title }}">{{ site.data.en.portfolio.title }}</h2>
                        <hr class="star-primary">
                    </div>
                </div>
                
                <!-- Category Filter -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="portfolio-filter text-center">
                            <button type="button" class="filter-btn active" data-filter="all" data-en="{{ site.data.en.portfolio.filter.all }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.all }}">{{ site.data.en.portfolio.filter.all }}</button>
                            <button type="button" class="filter-btn" data-filter="roblox" data-en="{{ site.data.en.portfolio.filter.roblox }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.roblox }}">{{ site.data.en.portfolio.filter.roblox }}</button>
                            <button type="button" class="filter-btn" data-filter="mobile" data-en="{{ site.data.en.portfolio.filter.mobile }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.mobile }}">{{ site.data.en.portfolio.filter.mobile }}</button>
                            <button type="button" class="filter-btn" data-filter="ar" data-en="{{ site.data.en.portfolio.filter.ar }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.ar }}">{{ site.data.en.portfolio.filter.ar }}</button>
                            <button type="button" class="filter-btn" data-filter="web" data-en="{{ site.data.en.portfolio.filter.web }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.web }}">{{ site.data.en.portfolio.filter.web }}</button>
                            <button type="button" class="filter-btn" data-filter="educational" data-en="{{ site.data.en.portfolio.filter.educational }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.educational }}">{{ site.data.en.portfolio.filter.educational }}</button>
                            <button type="button" class="filter-btn" data-filter="cultural" data-en="{{ site.data.en.portfolio.filter.cultural }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.cultural }}">{{ site.data.en.portfolio.filter.cultural }}</button>
                            <button type="button" class="filter-btn" data-filter="children" data-en="{{ site.data.en.portfolio.filter.children }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.children }}">{{ site.data.en.portfolio.filter.children }}</button>
                            <button type="button" class="filter-btn" data-filter="sports" data-en="{{ site.data.en.portfolio.filter.sports }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.sports }}">{{ site.data.en.portfolio.filter.sports }}</button>
                            <button type="button" class="filter-btn" data-filter="vehicles" data-en="{{ site.data.en.portfolio.filter.vehicles }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.vehicles }}">{{ site.data.en.portfolio.filter.vehicles }}</button>
                            <button type="button" class="filter-btn" data-filter="multiplayer" data-en="{{ site.data.en.portfolio.filter.multiplayer }}" data-pt-br="{{ site.data['pt-br'].portfolio.filter.multiplayer }}">{{ site.data.en.portfolio.filter.multiplayer }}</button>
                        </div>
                    </div>
                </div>
                
                <div class="row portfolio-grid">
                    {% for project in site.data.projects %}
                        <div class="col-md-6 col-lg-4 portfolio-item" data-categories="{{ project.category | join: ' ' }}">
                            <a href="#portfolioModal{{ forloop.index }}" class="portfolio-link" data-toggle="modal">
                                <div class="portfolio-image-container">
                                    <div class="caption">
                                        <div class="caption-content">
                                            <i class="fa fa-search-plus fa-3x"></i>
                                        </div>
                                    </div>
                                    <img src="{{ project.image | prepend: '/' }}" 
                                         onerror="this.src='https://via.placeholder.com/300x300/003366/FFFFFF?text={{ project.name | url_encode }}'"
                                         class="portfolio-image" alt="{{ project.name }}">
                                </div>
                                <h4 class="portfolio-title" data-en="{{ site.data.en.projects[project.name].name | default: project.name }}" data-project-key="{{ project.name }}">{{ site.data.en.projects[project.name].name | default: project.name }}</h4>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="success" id="about">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2 data-en="{{ site.data.en.about.title }}" data-pt-br="{{ site.data['pt-br'].about.title }}">{{ site.data.en.about.title }}</h2>
                        <hr class="star-light">
                    </div>
                </div>
                    <div class="row">
                                                <div class="col-lg-6" data-en="">
                                                        {% for para in site.data.en.about.paragraphs %}
                                                            {% if forloop.index0 < 3 %}
                                                                <p data-en="{{ para | escape }}" data-pt-br="{{ site.data['pt-br'].about.paragraphs[forloop.index0] | escape }}">{{ para }}</p>
                                                            {% endif %}
                                                        {% endfor %}
                                                </div>
                                                <div class="col-lg-6">
                                                        {% for para in site.data.en.about.paragraphs %}
                                                            {% if forloop.index0 >= 3 %}
                                                                <p data-en="{{ para | escape }}" data-pt-br="{{ site.data['pt-br'].about.paragraphs[forloop.index0] | escape }}">{{ para }}</p>
                                                            {% endif %}
                                                        {% endfor %}
                                                </div>
                        <div class="col-lg-8 col-lg-offset-2 text-center">
                            <a href="#contact" class="btn btn-lg btn-success page-scroll">
                                <i class="fa fa-envelope"></i> <span data-en="{{ site.data.en.about.start_project }}" data-pt-br="{{ site.data['pt-br'].about.start_project }}">{{ site.data.en.about.start_project }}</span>
                            </a>
                        </div>
                    </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2 data-en="{{ site.data.en.contact.title }}" data-pt-br="{{ site.data['pt-br'].contact.title }}">{{ site.data.en.contact.title }}</h2>
                        <hr class="star-primary">
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2">
                            <div class="text-center" style="margin-top: 40px;">
                                <h3 data-en="{{ site.data.en.contact.who_title }}" data-pt-br="{{ site.data['pt-br'].contact.who_title }}">{{ site.data.en.contact.who_title }}</h3>
                                <ul class="text-left" style="max-width: 600px; margin: 0 auto;">
                                    {% for item in site.data.en.contact.who %}
                                    <li><strong data-en="{{ item.title }}" data-pt-br="{{ site.data['pt-br'].contact.who[forloop.index0].title }}">{{ item.title }}</strong> <span data-en="{{ item.desc }}" data-pt-br="{{ site.data['pt-br'].contact.who[forloop.index0].desc }}">{{ item.desc }}</span></li>
                                    {% endfor %}
                                </ul>
                                <br>
                                <p><strong data-en="{{ site.data.en.contact.direct_email }}" data-pt-br="{{ site.data['pt-br'].contact.direct_email }}">{{ site.data.en.contact.direct_email }}</strong> <a href="mailto:{{ site.email }}">{{ site.email }}</a></p>
                                <p data-en="{{ site.data.en.contact.available }}" data-pt-br="{{ site.data['pt-br'].contact.available }}">{{ site.data.en.contact.available }}</p>
                            </div>
                            <p class="text-center" data-en="{{ site.data.en.contact.subtitle }}" data-pt-br="{{ site.data['pt-br'].contact.subtitle }}">{{ site.data.en.contact.subtitle }}</p>
                        
                        <!-- Contact Form -->
                        <form name="sentMessage" id="contactForm" novalidate action="https://formspree.io/f/xwprkddy" method="POST">
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label data-en="{{ site.data.en.contact.form.label_name }}" data-pt-br="{{ site.data['pt-br'].contact.form.label_name }}">{{ site.data.en.contact.form.label_name }}</label>
                                    <input type="text" class="form-control" placeholder="{{ site.data.en.contact.form.placeholder_name }}" id="name" name="name" required data-validation-required-message="{{ site.data.en.contact.form.validation_name }}" data-en-validation="{{ site.data.en.contact.form.validation_name }}" data-pt-br-validation="{{ site.data['pt-br'].contact.form.validation_name }}" data-en-placeholder="{{ site.data.en.contact.form.placeholder_name }}" data-pt-br-placeholder="{{ site.data['pt-br'].contact.form.placeholder_name }}">
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label data-en="{{ site.data.en.contact.form.label_email }}" data-pt-br="{{ site.data['pt-br'].contact.form.label_email }}">{{ site.data.en.contact.form.label_email }}</label>
                                    <input type="email" class="form-control" placeholder="{{ site.data.en.contact.form.placeholder_email }}" id="email" name="email" required data-validation-required-message="{{ site.data.en.contact.form.validation_email }}" data-en-validation="{{ site.data.en.contact.form.validation_email }}" data-pt-br-validation="{{ site.data['pt-br'].contact.form.validation_email }}" data-en-placeholder="{{ site.data.en.contact.form.placeholder_email }}" data-pt-br-placeholder="{{ site.data['pt-br'].contact.form.placeholder_email }}">
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label data-en="{{ site.data.en.contact.form.label_company }}" data-pt-br="{{ site.data['pt-br'].contact.form.label_company }}">{{ site.data.en.contact.form.label_company }}</label>
                                    <input type="text" class="form-control" placeholder="{{ site.data.en.contact.form.placeholder_company }}" id="company" name="company" data-en-placeholder="{{ site.data.en.contact.form.placeholder_company }}" data-pt-br-placeholder="{{ site.data['pt-br'].contact.form.placeholder_company }}">
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label data-en="{{ site.data.en.contact.form.label_project_type }}" data-pt-br="{{ site.data['pt-br'].contact.form.label_project_type }}">{{ site.data.en.contact.form.label_project_type }}</label>
                                    <select class="form-control" id="projectType" name="projectType">
                                        <option value="" data-en="{{ site.data.en.contact.form.option_select_project_type }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_select_project_type }}">{{ site.data.en.contact.form.option_select_project_type }}</option>
                                        <option value="roblox" data-en="{{ site.data.en.contact.form.option_roblox }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_roblox }}">{{ site.data.en.contact.form.option_roblox }}</option>
                                        <option value="mobile" data-en="{{ site.data.en.contact.form.option_mobile }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_mobile }}">{{ site.data.en.contact.form.option_mobile }}</option>
                                        <option value="ar" data-en="{{ site.data.en.contact.form.option_ar }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_ar }}">{{ site.data.en.contact.form.option_ar }}</option>
                                        <option value="vr" data-en="{{ site.data.en.contact.form.option_vr }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_vr }}">{{ site.data.en.contact.form.option_vr }}</option>
                                        <option value="web" data-en="{{ site.data.en.contact.form.option_web }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_web }}">{{ site.data.en.contact.form.option_web }}</option>
                                        <option value="phygital" data-en="{{ site.data.en.contact.form.option_phygital }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_phygital }}">{{ site.data.en.contact.form.option_phygital }}</option>
                                        <option value="other" data-en="{{ site.data.en.contact.form.option_other }}" data-pt-br="{{ site.data['pt-br'].contact.form.option_other }}">{{ site.data.en.contact.form.option_other }}</option>
                                    </select>
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="row control-group">
                                <div class="form-group col-xs-12 floating-label-form-group controls">
                                    <label data-en="{{ site.data.en.contact.form.label_message }}" data-pt-br="{{ site.data['pt-br'].contact.form.label_message }}">{{ site.data.en.contact.form.label_message }}</label>
                                    <textarea rows="5" class="form-control" placeholder="{{ site.data.en.contact.form.placeholder_message }}" id="message" name="message" required data-validation-required-message="{{ site.data.en.contact.form.validation_message }}" data-en-placeholder="{{ site.data.en.contact.form.placeholder_message }}" data-pt-br-placeholder="{{ site.data['pt-br'].contact.form.placeholder_message }}" data-en-validation="{{ site.data.en.contact.form.validation_message }}" data-pt-br-validation="{{ site.data['pt-br'].contact.form.validation_message }}"></textarea>
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <!-- Honeypot to deter bots (leave hidden). Formspree will ignore blank values; bots often fill this. -->
                            <input type="text" name="_gotcha" id="_gotcha" style="display:none" tabindex="-1" autocomplete="off">
                            <br>
                            <div id="success"></div>
                            <div class="row">
                                <div class="form-group col-xs-12 text-center">
                                    <button type="submit" class="btn btn-success btn-lg" data-en="{{ site.data.en.contact.form.send_button }}" data-pt-br="{{ site.data['pt-br'].contact.form.send_button }}">{{ site.data.en.contact.form.send_button }}</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
    <footer class="text-center">
            <div class="footer-above">
                <div class="container">
                    <div class="row">
                        <div class="footer-col col-md-4">
                            <h3 data-en="{{ site.data.en.footer.philosophy_title }}" data-pt-br="{{ site.data['pt-br'].footer.philosophy_title }}">{{ site.data.en.footer.philosophy_title }}</h3>
                            <p data-en="{{ site.data.en.footer.philosophy_text }}" data-pt-br="{{ site.data['pt-br'].footer.philosophy_text }}">{{ site.data.en.footer.philosophy_text }}</p>
                        </div>
                        <div class="footer-col col-md-4">
                            <h3 data-en="{{ site.data.en.footer.connect_title }}" data-pt-br="{{ site.data['pt-br'].footer.connect_title }}">{{ site.data.en.footer.connect_title }}</h3>
                            <ul class="list-inline">
                                {% if site.email %}
                                <li>
                                    <a href="mailto:{{ site.email }}" class="btn-social btn-outline">
                                        <i class="fa fa-fw fa-envelope"></i>
                                    </a>
                                </li>
                                {% endif %}
                                {% if site.github_username %}
                                <li>
                                    <a href="https://github.com/{{ site.github_username }}" class="btn-social btn-outline" target="_blank">
                                        <i class="fa fa-fw fa-github"></i>
                                    </a>
                                </li>
                                {% endif %}
                                {% if site.linkedin_username %}
                                <li>
                                    <a href="https://linkedin.com/in/{{ site.linkedin_username }}" class="btn-social btn-outline" target="_blank">
                                        <i class="fa fa-fw fa-linkedin"></i>
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </div>
                        <div class="footer-col col-md-4">
                            <h3 data-en="{{ site.data.en.footer.technology_title }}" data-pt-br="{{ site.data['pt-br'].footer.technology_title }}">{{ site.data.en.footer.technology_title }}</h3>
                            <p data-en="{{ site.data.en.footer.technology_text }}" data-pt-br="{{ site.data['pt-br'].footer.technology_text }}">{{ site.data.en.footer.technology_text }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer-below">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            Copyright &copy; {{ site.title }} {{ 'now' | date: "%Y" }} - <span data-en="{{ site.data.en.footer.studio_tag }}" data-pt-br="{{ site.data['pt-br'].footer.studio_tag }}">{{ site.data.en.footer.studio_tag }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
        <div class="scroll-top page-scroll visible-xs visible-sm">
            <a class="btn btn-primary" href="#page-top">
                <i class="fa fa-chevron-up"></i>
            </a>
        </div>

        <!-- Portfolio Modals -->
        {% for project in site.data.projects %}
            <div class="portfolio-modal modal fade" id="portfolioModal{{ forloop.index }}" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="close-modal" data-dismiss="modal">
                            <div class="lr">
                                <div class="rl">
                                </div>
                            </div>
                        </div>
                        <div class="container">
                            <div class="row">
                                <div class="col-lg-8 col-lg-offset-2">
                                    <div class="modal-body">
                                        <h2 class="text-center" data-en="{{ site.data.en.projects[project.name].name | default: project.name }}" data-project-key="{{ project.name }}">{{ site.data.en.projects[project.name].name | default: project.name }}</h2>
                                        <hr class="star-primary">
                                        
                                        <!-- Project Media Carousel -->
                                        {% if project.carousel and project.carousel.size > 0 %}
                                        <div class="project-carousel">
                                            <div id="projectCarousel{{ forloop.index }}" class="carousel slide" data-ride="carousel" data-interval="false">
                                                <!-- Indicators -->
                                                {% if project.carousel.size > 1 %}
                                                <ol class="carousel-indicators">
                                                    {% for item in project.carousel %}
                                                    <li data-target="#projectCarousel{{ forloop.parentloop.index }}" data-slide-to="{{ forloop.index0 }}" {% if forloop.first %}class="active"{% endif %}></li>
                                                    {% endfor %}
                                                </ol>
                                                {% endif %}
                                                
                                                <!-- Carousel Items -->
                                                <div class="carousel-inner" role="listbox">
                                                    {% for item in project.carousel %}
                                                    <div class="item {% if forloop.first %}active{% endif %}">
                                                        {% if item.type == "youtube" %}
                                                        <div class="video-container">
                                                            <iframe src="https://www.youtube.com/embed/{{ item.id }}?autoplay=0&rel=0&modestbranding=1&showinfo=0" 
                                                                    frameborder="0" 
                                                                    allowfullscreen
                                                                    class="carousel-video">
                                                            </iframe>
                                                        </div>
                                                        {% elsif item.type == "image" %}
                                                        <div class="image-container">
                                                            <img src="{{ item.src | prepend: '/' }}" 
                                                                 onerror="this.src='https://via.placeholder.com/600x400/003366/FFFFFF?text=Image+Not+Found'"
                                                                 class="carousel-image" alt="Project Image">
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                                
                                                <!-- Left and right controls -->
                                                {% if project.carousel.size > 1 %}
                                                    <a class="left carousel-control" href="#projectCarousel{{ forloop.index }}" role="button" data-slide="prev">
                                                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                                    <span class="sr-only" data-en="{{ site.data.en.aria.previous }}" data-pt-br="{{ site.data['pt-br'].aria.previous }}">{{ site.data.en.aria.previous }}</span>
                                                </a>
                                                <a class="right carousel-control" href="#projectCarousel{{ forloop.index }}" role="button" data-slide="next">
                                                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                                    <span class="sr-only" data-en="{{ site.data.en.aria.next }}" data-pt-br="{{ site.data['pt-br'].aria.next }}">{{ site.data.en.aria.next }}</span>
                                                </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% else %}
                                        <!-- Fallback to single image if no carousel data -->
                                        <div class="text-center">
                                            <img src="{{ project.image | prepend: '/' }}" 
                                                 onerror="this.src='https://via.placeholder.com/600x400/003366/FFFFFF?text={{ project.name | url_encode }}'"
                                                 class="img-responsive modal-image" alt="{{ project.name }}">
                                        </div>
                                        {% endif %}
                                        
                                        <div class="project-details">
                                            <p class="text-center" data-en="{{ site.data.en.projects[project.name].description | default: project.description }}" data-project-key="{{ project.name }}.description">{{ site.data.en.projects[project.name].description | default: project.description }}</p>
                                            <div class="text-center project-categories">
                                                <strong data-en="{{ site.data.en.modal.categories }}" data-pt-br="{{ site.data['pt-br'].modal.categories }}">{{ site.data.en.modal.categories }}</strong>
                                                {% if project.category %}
                                                    {% if project.category.size > 1 %}
                                                        <!-- Multiple categories as array -->
                                                        {% for cat in project.category %}
                                                        {% assign catkey = cat | downcase %}
                                                        {% assign cat_pt = site.data['pt-br'].portfolio.filter[catkey] %}
                                                        <span class="category-badge" data-en="{{ cat | capitalize }}" data-pt-br="{{ cat_pt | default: cat | capitalize }}">{{ cat | capitalize }}</span>
                                                        {% endfor %}
                                                    {% else %}
                                                        <!-- Single category or first item of array -->
                                                        {% if project.category.first %}
                                                            <!-- It's an array with one item -->
                                                            {% assign cat = project.category.first %}
                                                            {% assign catkey = cat | downcase %}
                                                            {% assign cat_pt = site.data['pt-br'].portfolio.filter[catkey] %}
                                                            <span class="category-badge" data-en="{{ cat | capitalize }}" data-pt-br="{{ cat_pt | default: cat | capitalize }}">{{ cat | capitalize }}</span>
                                                        {% else %}
                                                            <!-- It's a string -->
                                                            {% assign cat = project.category %}
                                                            {% assign catkey = cat | downcase %}
                                                            {% assign cat_pt = site.data['pt-br'].portfolio.filter[catkey] %}
                                                            <span class="category-badge" data-en="{{ cat | capitalize }}" data-pt-br="{{ cat_pt | default: cat | capitalize }}">{{ cat | capitalize }}</span>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                            <div class="text-center modal-buttons">
                                                {% for cta in project.ctas %}
                                                    {% if cta.type == "play" %}
                                                        {% assign button_text = site.data.en.modal.play %}
                                                        {% assign button_text_pt = site.data['pt-br'].modal.play %}
                                                        {% assign button_icon = "fa-gamepad" %}
                                                    {% elsif cta.type == "download" %}
                                                        {% assign button_text = site.data.en.modal.download %}
                                                        {% assign button_text_pt = site.data['pt-br'].modal.download %}
                                                        {% assign button_icon = "fa-mobile" %}
                                                    {% elsif cta.type == "ar" %}
                                                        {% assign button_text = site.data.en.modal.view_ar %}
                                                        {% assign button_text_pt = site.data['pt-br'].modal.view_ar %}
                                                        {% assign button_icon = "fa-cube" %}
                                                    {% else %}
                                                        {% assign button_text = site.data.en.modal.view_project %}
                                                        {% assign button_text_pt = site.data['pt-br'].modal.view_project %}
                                                        {% assign button_icon = "fa-external-link" %}
                                                    {% endif %}
                                                    
                                                    <a href="{{ cta.url }}" class="btn btn-success btn-lg" target="_blank">
                                                        <i class="fa {{ button_icon }}"></i> <span class="cta-button-text" data-en="{{ button_text }}" data-pt-br="{{ button_text_pt }}">{{ button_text }}</span>
                                                    </a>
                                                {% endfor %}
                                                {% if project.instagram %}
                                                <a href="{{ project.instagram }}" class="btn btn-instagram btn-lg" target="_blank">
                                                    <i class="fa fa-instagram"></i> <span data-en="{{ site.data.en.modal.instagram }}" data-pt-br="{{ site.data['pt-br'].modal.instagram }}">{{ site.data.en.modal.instagram }}</span>
                                                </a>
                                                {% endif %}
                                                <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">
                                                    <i class="fa fa-times"></i> <span data-en="{{ site.data.en.modal.close }}" data-pt-br="{{ site.data['pt-br'].modal.close }}">{{ site.data.en.modal.close }}</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}

        <!-- Custom JavaScript -->
        <script>
        // Expose Portuguese project translations from window.I18N (populated above)
        (function(){
            try {
                window.projectTranslations = (window.I18N && window.I18N['pt-br'] && window.I18N['pt-br'].projects) ? window.I18N['pt-br'].projects : {};
            } catch (e) {
                console.error('Failed to initialize projectTranslations', e);
                window.projectTranslations = {};
            }
        })();

        $(document).ready(function() {
            // Custom active-nav handler: compute offsets after load and update active link deterministically
            $(window).on('load', function() {
                var navHeight = $('.navbar-fixed-top').outerHeight() || 0;

                // Sections we care about (order matters)
                var sections = [
                    { id: '#page-top' },
                    { id: '#portfolio' },
                    { id: '#about' },
                    { id: '#contact' }
                ];

                function computeOffsets() {
                    sections.forEach(function(s) {
                        var $el = $(s.id);
                        s.offset = $el.length ? Math.floor($el.offset().top) : Infinity;
                    });
                }

                // Simple throttle
                function throttle(fn, wait) {
                    var last = 0;
                    return function() {
                        var now = Date.now();
                        if (now - last >= wait) {
                            last = now;
                            fn.apply(this, arguments);
                        }
                    };
                }

                function updateActiveNav() {
                    var pos = $(document).scrollTop() + navHeight + 5;
                    var activeId = sections[0].id; // default to top
                    for (var i = 0; i < sections.length; i++) {
                        if (pos >= sections[i].offset) activeId = sections[i].id;
                    }

                    // Update nav classes
                    $('.navbar-nav li').removeClass('active');
                    var $link = $('.navbar-nav a[href="' + activeId + '"]');
                    if ($link.length) $link.parent('li').addClass('active');
                }

                // Initial compute and bind handlers
                computeOffsets();
                $(window).on('resize', throttle(function() {
                    navHeight = $('.navbar-fixed-top').outerHeight() || 0;
                    computeOffsets();
                    updateActiveNav();
                }, 150));

                $(window).on('scroll', throttle(updateActiveNav, 100));

                // One initial call to set the correct active item
                updateActiveNav();
            });

            // jQuery for page scrolling feature - requires jQuery Easing plugin
            $('a.page-scroll').bind('click', function(event) {
                var $anchor = $(this);
                $('html, body').stop().animate({
                    scrollTop: ($($anchor.attr('href')).offset().top - 50)
                }, 1250, 'easeInOutExpo');
                event.preventDefault();
            });

            // Closes the Responsive Menu on Menu Item Click
            $('.navbar-collapse ul li a').click(function() {
                $('.navbar-toggle:visible').click();
            });

            // Offset for Main Navigation
            $('#mainNav').affix({
                offset: {
                    top: 100
                }
            })

            // Contact form functionality
            // Floating label functionality
            $('body').on('input propertychange', '.floating-label-form-group', function(e) {
                $(this).toggleClass('floating-label-form-group-with-value', !!$(e.target).val());
            }).on('focus', '.floating-label-form-group', function() {
                $(this).addClass('floating-label-form-group-with-focus');
            }).on('blur', '.floating-label-form-group', function() {
                $(this).removeClass('floating-label-form-group-with-focus');
            });

            // Contact form submission is handled in external `js/contact_me.js`.

            // Clear success messages on focus
            $('#name, #email, #company, #projectType, #message').focus(function() {
                $('#success').html('');
            });

            // Portfolio Filter Functionality
            // console.log('Number of filter buttons found:', $('.filter-btn').length);
            $('.filter-btn').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                var filterValue = $(this).data('filter');
                // console.log('Filter clicked:', filterValue); // Debug log
                
                // Update active button
                $('.filter-btn').removeClass('active');
                $(this).addClass('active');
                
                // Filter portfolio items
                if (filterValue === 'all') {
                    $('.portfolio-item').removeClass('hidden').addClass('visible');
                } else {
                    $('.portfolio-item').each(function() {
                        var categories = $(this).data('categories');
                        if (categories && categories.toString().includes(filterValue)) {
                            $(this).removeClass('hidden').addClass('visible');
                        } else {
                            $(this).removeClass('visible').addClass('hidden');
                        }
                    });
                }
            });

            // Initialize portfolio items as visible
            // console.log('Number of portfolio items found:', $('.portfolio-item').length);
            $('.portfolio-item').each(function(index) {
                var categories = $(this).data('categories');
                // console.log('Portfolio item', index, 'categories:', categories);
            });
            $('.portfolio-item').addClass('visible');

            // Stop YouTube videos when modal is closed
            $('.portfolio-modal').on('hidden.bs.modal', function () {
                var modal = $(this);
                // Find all iframes (YouTube videos) in this modal and reset their src
                modal.find('iframe').each(function() {
                    var src = $(this).attr('src');
                    if (src) {
                        $(this).attr('src', src);
                    }
                });
            });

            // Alternative method: pause videos by reloading iframe src
            $('.close-modal, .btn[data-dismiss="modal"]').click(function() {
                setTimeout(function() {
                    $('.portfolio-modal iframe').each(function() {
                        var src = $(this).attr('src');
                        if (src) {
                            $(this).attr('src', '');
                            $(this).attr('src', src);
                        }
                    });
                }, 300);
            });

            // Language Detection and Switching
            let currentLang = 'en';
            
            // Detect user's preferred language
            function detectLanguage() {
                const savedLang = localStorage.getItem('preferred-language');
                if (savedLang && (savedLang === 'en' || savedLang === 'pt-br')) {
                    return savedLang;
                }
                
                const browserLang = navigator.language || navigator.userLanguage;
                if (browserLang.toLowerCase().startsWith('pt')) {
                    return 'pt-br';
                }
                
                return 'en';
            }

            // Switch language function
            window.switchLanguage = function(lang) {
                currentLang = lang;
                localStorage.setItem('preferred-language', lang);

                // Helper to decode HTML entities (e.g. &lt;strong&gt;)
                function decodeEntities(encodedStr) {
                    var txt = document.createElement('textarea');
                    txt.innerHTML = encodedStr;
                    return txt.value;
                }

                // Update elements with data attributes (regular UI elements)
                document.querySelectorAll('[data-en][data-pt-br]').forEach(el => {
                    var text = el.getAttribute('data-' + lang);
                    if (text) {
                        // If the localized string contains encoded HTML entities, decode them first.
                        var decoded = (text.indexOf('&lt;') !== -1 || text.indexOf('&gt;') !== -1 || text.indexOf('&amp;') !== -1) ? decodeEntities(text) : text;
                        if (decoded.indexOf('<') !== -1) {
                            el.innerHTML = decoded;
                        } else {
                            el.textContent = decoded;
                        }
                    }
                });

                // Update placeholders for inputs and textareas
                document.querySelectorAll('[data-en-placeholder][data-pt-br-placeholder]').forEach(el => {
                    const ph = el.getAttribute('data-' + lang + '-placeholder');
                    if (ph) {
                        el.setAttribute('placeholder', ph);
                    }
                });

                // Update select option labels
                document.querySelectorAll('select option[data-en][data-pt-br]').forEach(opt => {
                    const text = opt.getAttribute('data-' + lang);
                    if (text) opt.textContent = text;
                });

                // Update project titles and descriptions
                document.querySelectorAll('[data-project-key]').forEach(el => {
                    const projectKey = el.getAttribute('data-project-key');
                    const originalText = el.getAttribute('data-en');

                    if (lang === 'pt-br') {
                        // Check if this is a description (contains .description)
                        if (projectKey.endsWith('.description')) {
                            const baseKey = projectKey.replace('.description', '');
                            if (projectTranslations[baseKey] && projectTranslations[baseKey].description) {
                                var desc = projectTranslations[baseKey].description;
                                if (desc) {
                                    var decodedDesc = (desc.indexOf('&lt;') !== -1 || desc.indexOf('&gt;') !== -1 || desc.indexOf('&amp;') !== -1) ? decodeEntities(desc) : desc;
                                    if (decodedDesc.indexOf('<') !== -1) {
                                        el.innerHTML = decodedDesc;
                                    } else {
                                        el.textContent = decodedDesc;
                                    }
                                }
                            }
                        } else {
                            // It's a title/name
                            if (projectTranslations[projectKey] && projectTranslations[projectKey].name) {
                                var name = projectTranslations[projectKey].name;
                                if (name) {
                                    var decodedName = (name.indexOf('&lt;') !== -1 || name.indexOf('&gt;') !== -1 || name.indexOf('&amp;') !== -1) ? decodeEntities(name) : name;
                                    if (decodedName.indexOf('<') !== -1) {
                                        el.innerHTML = decodedName;
                                    } else {
                                        el.textContent = decodedName;
                                    }
                                }
                            }
                        }
                    } else {
                        // Use English (original text from data-en attribute)
                        if (originalText) {
                            if (originalText.indexOf('<') !== -1 || originalText.indexOf('&lt;') !== -1) {
                                el.innerHTML = originalText;
                            } else {
                                el.textContent = originalText;
                            }
                        }
                    }
                });

                // Update CTA/other button spans
                document.querySelectorAll('button span[data-en][data-pt-br], a span[data-en][data-pt-br], span[data-en][data-pt-br]').forEach(el => {
                    // avoid overwriting elements that also have data-project-key
                    if (el.hasAttribute('data-project-key')) return;
                    var text = el.getAttribute('data-' + lang);
                    if (text) {
                        var decoded = (text.indexOf('&lt;') !== -1 || text.indexOf('&gt;') !== -1 || text.indexOf('&amp;') !== -1) ? decodeEntities(text) : text;
                        if (decoded.indexOf('<') !== -1) {
                            el.innerHTML = decoded;
                        } else {
                            el.textContent = decoded;
                        }
                    }
                });

                // Update language switcher active state
                document.querySelectorAll('.language-option').forEach(option => {
                    option.classList.toggle('active', option.getAttribute('data-lang') === lang);
                });
                // Update the visible current-language label if present
                const currentLabel = document.getElementById('current-language');
                if (currentLabel) {
                    const label = currentLabel.getAttribute('data-' + lang) || currentLabel.textContent;
                    currentLabel.textContent = label;
                }
            };

            // Initialize language on page load
            const initialLang = detectLanguage();
            switchLanguage(initialLang);
        });
        </script>
        <script>
        // Optional: set your Formspree reCAPTCHA v3 site key in _config.yml as `formspree_recaptcha_sitekey`.
        // If set, the contact script will load reCAPTCHA and include a token in submissions.
        window.FORMSPREE_RECAPTCHA_SITEKEY = '{{ site.formspree_recaptcha_sitekey | default: "" }}';
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqBootstrapValidation/1.3.7/jqBootstrapValidation.min.js"></script>
        <script src="{{ '/js/contact_me.js' | prepend: site.baseurl }}"></script>
    </body>
</html>